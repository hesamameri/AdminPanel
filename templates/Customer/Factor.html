{% load static %}
{% load converter_tags %}
<!DOCTYPE html>
<!-- 
    -titles on this page should be right aligned
    - this template seems to be for shops , find out how to use it
 -->
<html lang="fa">

    <!-- begin::Head -->

    {% include "partials/head.html" %} 
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js"></script>
    <head>
        <style>
            /* Style for the zoom buttons */
            .zoom-buttons {
                position: absolute;
                top: 10px;
                right: 10px;
            }
    
            /* Style for the zoomed image */
            .zoomed-image {
                max-width: 100%;
                max-height: 100%;
            }
        </style>
    </head>


    <!-- end::Head -->

    <!-- begin::Body -->

    <body
        class="kt-quick-panel--right kt-demo-panel--right kt-offcanvas-panel--right kt-header--fixed kt-header-mobile--fixed kt-subheader--enabled kt-subheader--transparent kt-aside--enabled kt-aside--fixed kt-page--loading">

        <!-- begin:: Header Mobile -->

        {% include "partials/MobileHeader.html" %}

        <!-- end:: Header Mobile -->

        <!-- begin:: Root -->
        <div class="kt-grid kt-grid--hor kt-grid--root">

            <!-- begin:: Page -->
            <div class="kt-grid__item kt-grid__item--fluid kt-grid kt-grid--ver kt-page">

                <!-- begin:: Aside -->
                {% include "partials/sidebar.html" %}


                <!-- end:: Aside -->

                <!-- begin:: Wrapper -->
                <div class="kt-grid__item kt-grid__item--fluid kt-grid kt-grid--hor kt-wrapper" id="kt_wrapper">

                    <!-- begin:: Header -->

                    {% include "partials/header.html" %}
                    <!-- end:: Header -->
                    <div class="kt-grid__item kt-grid__item--fluid kt-grid kt-grid--hor">

                        <!-- begin:: Subheader -->
                        {% include "partials/subheader.html" %}

                        <!-- end:: Subheader -->

                        <!-- begin:: Content -->
                        <div class="kt-content  kt-grid__item kt-grid__item--fluid" id="kt_content">
                            
                            <div class="content-wrapper">
                                <div class="content-header">
                                    <div class="container-fluid">
                                    
                                    <div class="row mb-2">
                                        <div class="col-sm-12">
                                        
                                                <ol class="breadcrumb float-sm ">
                                                    <li class="breadcrumb-item active"></li>
                                                    <li class="breadcrumb-item active">فاکتور فروش</li>
                                                </ol>
                                                <!-- <ol class="breadcrumb float-sm ">
                                                    <li class="breadcrumb-item active">تایید مالی</li>
                                                    <li class="breadcrumb-item active">فاکتور فروش</li>
                                                </ol>
                                                <ol class="breadcrumb float-sm ">
                                                    <li class="breadcrumb-item active">فاکتور فروش</li>
                                                    <li class="breadcrumb-item active">فاکتور فروش</li>
                                                    <li class="breadcrumb-item">مشتریان</li>
                                                </ol> -->
                                               
                                        </div>
                                    </div>
                                    </div>
                                </div>
                                    <!-- <div class="alert alert-danger rtl" role="alert"></div>
                                
                                    <div class="alert alert-success rtl" role="alert"></div>
                                
                                    <div class="rtl alert alert-danger">فاکتور فوق دارای چک با استعلام نامشخص/تایید نشده می‌باشد</div>
                             -->
                                <div class="content">
                                    <div class="container-fluid">
                                        <div class="row">
                            
                                            <div class="col-lg-9">
                                                
                                                <div class="card card-secondary card-outlines">
                                                    <div class="card-header rtl">
                                                        <h3 class="card-title rtl block ">محصولات</h3>
                                                        <button class="btn btn-sm btn-success card-fixed-left float-right" data-toggle="modal" data-target="#modal-product-item"><i class="fas fa-plus nav-icon"></i></button>
                                                      
                                                                <form method="POST"  action="">
                                                                    <button class="btn btn-sm btn-success card-fixed-left btn-account-confirm" style="display: none">تایید و برگشت</button>
                                                                </form>
                                                        
        
                                                    </div>
                                                    <div class="card-body">
                                                        <table class="table table-bordered table-striped table-hover ">
                                                            <thead>
                                                                <tr>
                                                                    <th>کد</th>
                                                                    <th>عنوان</th>
                                                                    <th>تعداد</th>
                                                                    {% if request.user.user_id|goods_register_access %}
                                                                    <th> ارسال شده </th>
                                                                    {% endif %}
                                                                    <th>فی<span class="small">(ریال)</span></th>
                                                                    <th>مبلغ<span class="small">(ریال)</span></th>
                                                                    <th>تخفیف<span class="small">(ریال)</span></th>
                                                                    <th>مالیات<span class="small">(ریال)</span></th>
                                                                    <th>مبلغ نهایی<span class="small">(ریال)</span></th>
                                                                        <!-- <th>تعداد</th>
                                                                        <th>ارسال شده</th>
                                                                        <th>مانده</th> -->
                                                             
                                                                    <th></th>
                                                                </tr>
                                                            </thead>
                                                            <tbody>
                                                                {% for product in factor_item %}
                                                                <tr class="row-small">
                                                                    <td>{{ product.obj_item.obj_item_id}}</td>
                                                                    <td>
                                                                        {{product.obj_item.name}}
                                                                            <br>
                                                                            
                                                                    </td>
                                                                    
                                                                    <td class="amount"> {{product.amount}} </td>
                                                                    {% if request.user.user_id|goods_register_access %}
                                                                    <td> {{product.sended}} </td>
                                                                    {% endif %}
                                                                    <td class="total-price"> {{product.unit_price|inter}} </td>
                                                                    <td class="price">{{product.price|inter}}</td>
                                                                    <td class="total-discount">
                                                                        {{product.discount_price|inter}}
                                                                    </td>
                                                                    <td>
                                                                       0
                                                                    </td>
                                                                    <td class="row-total" >
                                                                        {% with num1=product.unit_price num2=product.amount subtract_value=product.discount_price %}
                                                                             {% multiply_and_subtract num1=num1 num2=num2 subtract_value=subtract_value %}
                                                                        {% endwith %}
                                                                        
                                                                    </td>
                                                                   
                            
                                                                    <!-- <td>

                                                                    </td> 


                                                                    <td></td>  -->



                                                                        <td>
                                                                            <form method="POST" action="{% url 'customer:delete_goods' element=product.factor_item_id %}">
                                                                                {% csrf_token %}
                                                                                <input type="hidden" name="form_type" value="addgoods">
                                                                                <input type="hidden" name="factor" value="{{ factor_main.factor_id }}">
                                                                                <button type="submit" class="btn btn-danger btn-xs"><i class="fas fa-times"></i></button>
                                                                            </form>
                                                                        </td>
                            
                                                                        <!-- <td></td>
                                                                        <td>
                                                                            
                                                                        </td> -->
                                                                        <!-- <td>
                                                                        </td> -->
                                                                    {% if request.user.user_id|goods_register_access %}
                                                                        <td>
                                                                           
                                                                                <button class="btn btn-sm btn-success btn-asign-depo" 
                                                                                        data-toggle="modal" 
                                                                                        data-obid="{{product.obj_item_id}}"
                                                                                        data-fid="{{product.factor_item_id}}"
                                                                                        data-amount="{{product.amount}}" 
                                                                                        data-sended="{{product.sended}}"
                                                                                        data-target="#modal-assign-depo"><i class="fas fa-plus nav-icon"></i></button>
                                                                        </td>
                                                                        
                                                                            
                                                                    {% endif %}
                                                                </tr>
                                                                {% endfor %}
                                                                

                                                             
                                                                
                                                                
                                                                <tr class="row-small">
                                                                    <td class="bold text-left "  colspan="4">حمع مبلغ کالا/خدمات</td>
                                                                    <td colspan="4" class="grand-total-price"> <small>ریال</small> </td>
                                                                </tr>
                                                                <tr class="row-small">
                                                                    <td class="bold text-left" colspan="4">حمع تخفیف</td>
                                                                    <td colspan="4" class="grand-total-discount" > <small>ریال</small></td>
                                                                </tr>
                                                                <tr class="row-small">
                                                                    <td class="bold text-left" colspan="4">حمع سهم سازمان‌ها</td>
                                                                    <td colspan="4"> <small>ریال</small></td>
                                                                </tr>
                                                                <tr class="row-small">
                                                                    <td class="bold text-left"  colspan="4">جمع کل</td>
                                                                    <td colspan="4" class="grand-row-total"> <small>ریال</small></td>
                                                                </tr>
                                                            </tbody>
                                                        </table>
                                                            <div class="badge badge-warning col-sm-12 rtl text-right">
                                                            </div>
                                                    </div>
                                                </div><!-- /card item -->
                            
                                                <div class="row">
                                                    <div class="col-lg-12">
                                                        <div class="card card-secondary card-outlines">
                                                            <div class="card-header rtl">
                                                                <h3 class="card-title rtl block ">پرداختی‌ها</h3>
                                                                    <button class="btn btn-sm btn-success card-fixed-left float-right" data-toggle="modal" data-target="#modal-inquiry1"><i class="fas fa-plus nav-icon"></i></button>
                                                                
                                                            </div>
                                                            <div class="card-body">
                                                                <table class="table table-bordered table-striped table-hover font-sm ">
                                                                    <thead>
                                                                        <tr>
                                                                            <th>مرحله</th>
                                                                            <th>نحوه پرداخت</th>
                                                                            <th>شناسه</th>
                                                                            <th>مبلغ <span class="small">(ریال)</span></th>
                                                                            <th>توضیحات</th>
                                                                            <th>ثبت کننده</th>
                                                                            <th>زمان ثبت</th>
                                                                            <th></th>
                                                                        </tr>
                                                                    </thead>
                                                                    <tbody>
                                                                        {% for item in factor_payway %}
                                                                        <tr>
                                                                            {% if item.pay_level == 'FACTOR' %}
                                                                            <td>
                                                                            فاکتور
                                                                            </td>
                                                                            {% elif item.pay_level == 'DRIVE' %}
                                                                            <td> حمل</td>
                                                                            {% else %}
                                                                            <td> </td>
                                                                            {% endif %}
                                                                            <td>{{ item.pay_type|pay_to_way}}</td>
                                                                            {% if item.no == None %}
                                                                            <td></td>
                                                                            {% else %}
                                                                            <td>{{ item.no }}</td>
                                                                            {% endif %}
                                                                            <td> {{item.price}} </td>
                                                                            {% if item.description == None %}
                                                                            <td></td>
                                                                            {% else %}
                                                                            <td>{{item.description}}</td>
                                                                            {% endif %}
                                                                            {% if item.register > 2 %}
                                                                            <td> {{item.register|register_user}}</td>
                                                                            {% else %}
                                                                            <td>
                                                                              
                                                                            </td>
                                                                            {% endif %}
                                                                            <td>{{item.reg_dt|to_jalali}}</td>
                                                                            <td>
                                                                                <form method="POST" action="{% url 'customer:delete_payway' element=item.factor_payway_id %}">
                                                                                    {% csrf_token %}
                                                                                    <input type="hidden" name="factor" value="{{ factor_main.factor_id }}">
                                                                                    <input type="hidden" name="form_type" value="paywayform">
                                                                                    <button type="submit" class="btn btn-danger btn-xs"><i class="fas fa-times"></i></button>
                                                                                </form>
                                                                            </td>
                                                                            
                                                                        </tr>
                                                                        {% endfor %}
                                                                      
                                                                        <!-- <tr>
                                                                            <td></td>
                                                                            <td colspan="2">بدهکار</td>
                                                                            <td colspan="2">بستانکار</td>
                                                                        </tr>
                                                                        <tr>
                                                                            <td>مانده فاکتور: </td>
                                                                            <td colspan="2"></td>
                                                                            <td colspan="2">0</td>
                                                                        </tr>
                                                                        <tr>
                                                                            <td>مانده حساب کل:</td>
                                                                            
                                                                            <td colspan="2">0</td>
                                                                            <td colspan="2"></td>
                                                                        </tr>
                                                                        <tr>
                                                                            <td>جمع:</td>
                                                                            
                                                                            <td colspan="2"></td>
                                                                            <td colspan="2"></td>
                                                                        </tr> -->
                                                                       
                                                                    </tbody>
                                                                </table>
                            
                            
                                                            </div>
                                                        </div>
                            
                                                    </div>
                                                    <div class="col-lg-12">
                            
                                                        <div class="card card-secondary card-outlines">
                                                            <div class="card-header rtl">
                                                                <h3 class="card-title rtl block ">مدارک</h3>
                                                                    <button class="btn btn-sm btn-success card-fixed-left float-right" data-toggle="modal" data-target="#modal-document"><i class="fas fa-plus nav-icon"></i></button>
                                                               
                                                            </div>
                                                            <div class="card-body">
                                                                <table class="table table-bordered table-striped table-hover font-sm">
                                                                    <thead>
                                                                        <tr>
                                                                            <th>تصویر</th>
                                                                            <th>توضیحات</th>
                                                                            <th>ثبت کننده</th>
                                                                            <th>زمان ثبت</th>
                                                                            <th></th> 
                                                                        </tr>
                                                                    </thead>
                                                                    <tbody>
                                                                        {% for doc in factor_document %}
                                                                        <tr> 
                                                                            <td>
                                                                                <a href="{{ doc.uri }}" target="_blank" onclick="openImageWindow(event)">
                                                                                    <img class="img img-rectangle img-popup-img-srces" height="60px" src="{{ doc.uri }}">
                                                                                </a>
                                                                            </td>
                                                                        
                                                                            <script>
                                                                                // Function to open a new window with the image and zoom controls
                                                                                function openImageWindow(event) {
                                                                                    event.preventDefault();
                                                                                    const imageUrl = event.target.getAttribute('src');
                                                                        
                                                                                    // Open a new window
                                                                                    const newWindow = window.open(imageUrl, 'Image', 'width=800, height=600');
                                                                        
                                                                                    // Create zoom-in button
                                                                                    const zoomInButton = document.createElement('button');
                                                                                    zoomInButton.textContent = 'Zoom In';
                                                                                    zoomInButton.onclick = function () {
                                                                                        newWindow.document.querySelector('img').style.transform = 'scale(1.5)';
                                                                                    };
                                                                        
                                                                                    // Create zoom-out button
                                                                                    const zoomOutButton = document.createElement('button');
                                                                                    zoomOutButton.textContent = 'Zoom Out';
                                                                                    zoomOutButton.onclick = function () {
                                                                                        newWindow.document.querySelector('img').style.transform = 'scale(1)';
                                                                                    };
                                                                        
                                                                                    // Create a div for the zoom buttons
                                                                                    const zoomButtonsDiv = document.createElement('div');
                                                                                    zoomButtonsDiv.className = 'zoom-buttons';
                                                                                    zoomButtonsDiv.appendChild(zoomInButton);
                                                                                    zoomButtonsDiv.appendChild(zoomOutButton);
                                                                        
                                                                                    // Append the zoom buttons to the new window
                                                                                    newWindow.document.body.appendChild(zoomButtonsDiv);
                                                                                }
                                                                            </script>

                                                                        {% if doc.level_type == None %}
                                                                            <td>
                                                                                {{doc.level_type}}
                                                                                <!-- <hr>
                                                                                تکراری در فاکتور:  -->
                                                                            </td>
                                                                          
                                                                        {% else%} 
                                                                        <td>
                                                                        
                                                                            <!-- <hr>
                                                                            تکراری در فاکتور:  -->
                                                                            
                                                                        </td> 
                                                                        {% endif %}
                                                                            {% if doc.register > 2 %}
                                                                            <td> {{doc.register|register_user}}</td>
                                                                            {% else %}
                                                                            <td>
                                                                                غیرفعال در سیستم
                                                                            </td>
                                                                            {% endif %}
                                                                            <td>
                                                                              {{doc.reg_dt|to_jalali}}
                                                                            </td>
                                                                            <td>
                                                                                <form method="POST" action="{% url 'customer:delete_document' element=doc.factor_document_id %}">
                                                                                    {% csrf_token %}
                                                                                    <input type="hidden" name="form_type" value="document">
                                                                                    <input type="hidden" name="factor" value="{{factor_main.factor_id}}">
                                                                                    <button type="submit" class="btn btn-danger btn-xs"><i class="fas fa-times"></i></button>
                                                                                </form>
                                                                            </td>
                                                                            
                                                                        </tr>

                                                                        {% endfor %}
                            
                                                                    </tbody>
                                                                </table>
                                                            </div>
                                                        </div>
                            
                                                    </div>
                                                    <br>
                                                    
                                                    {% if factor_main.factore_desc == None %}
                                                    {% else %}
                                                    <div class="col-lg-12">
                                                        <div class="card card-secondary card-outlines">
                                                            <div class="card-header rtl">
                                                                <h3 class="card-title rtl block ">توضیحات فاکتور</h3>
                                                            </div>
                                                            <div class="card-body rtl">
                                                                <b>توضیحات فاکتور: </b>
                                                                {% if factor_main.factore_desc == None %}
                                                                {% else %}
                                                                {{factor_main.factore_desc}}
                                                                {% endif %}
                                                                <br>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    {% endif %}
                                                    
                                                    
                                                    {% if factor_main.acc_status == None %}
                                                    {% else %}
                                                    <div class="col-lg-12">
                                                        <div class="card card-secondary card-outlines">
                                                            <div class="card-header rtl">
                                                                <h3 class="card-title rtl block">تاییدیه امور مالی</h3>
                                                            </div>
                                                            <div class="card-body rtl">
                                                                <b>وضعیت:</b> 
                                                                {% if factor_main.acc_status == 1 %}
                                                                تایید
                                                                
                                                                {% elif factor_main.reg_status == 0 %}
                                                                رد
                                                                {% else %}
                                                                نامعلوم
                                                                {% endif %}
                                                                <!-- This requires the inquiries to be retrieved from the database-->
                                                                <br>
                                                                <b>تایید کننده مالی: </b>{{factor_main.acc_confirmer}} <br> <b>تاریخ:</b> 
                                                                {{factor_main.acc_confirm_dt|to_jalali}} <br>
                                                                  <b>ساعت: </b> 
                                                                <br>
                                                                <b>توضیحات مالی: </b> 
                                                                {% if factor_main.acc_description == None %}
                                                                {% else %}
                                                                {{factor_main.acc_description}}
                                                                {% endif %}
                                                            </div>
                                                        </div>
                                                    </div>
                                                    {% endif %}
                                                
                            
                                                {% if depo_all == None %}
                                                {% else %}
                                                    <div class="col-lg-12">
                                                        <div class="card card-secondary card-outlines">
                                                            <div class="card-header rtl">
                                                                <h3 class="card-title rtl block ">اختصاص انبار</h3>
                                                            </div>
                                                            <div class="card-body rtl">
                                                                <table class="table">
                                                                    <thead>
                                                                        
                                                                    <tr>
                                                                        <th>کد کالا</th>
                                                                        <th>شرح کالا</th>
                                                                        <th>تعداد</th>
                                                                        <th>انبار</th>
                                                                        <th>ثبت کننده</th>
                                                                        <th>تاریخ</th>
                                                                        <th>ساعت</th>
                                                                    </tr>
                                                                    </thead>
                                                                    <tbody>
                                                                    {% for item,name in depo_all %}
                                                                    <tr>
                                                                        
                                                                        <td>{{item.goods}}</td>
                                                                        <td> {{name.0.name}} </td>
                                                                        <td>{{item.amount|inter}}</td>
                                                                        <td>{{name.1.name|depo_location}}</td>
                                                                        <td>{{item.register|register_user}}</td>
                                                                        <td>{{item.reg_dt|to_jalali}}</td>
                                                                        <td></td>
                                                                    </tr>
                                                                    {% endfor %}
                                                                    </tbody>
                                                                   
                                                                </table>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    {% endif %}
                                                    
                                                    
                                                    <div class="col-lg-12">
                                                        {% for obj in obj_sendings %}
                                                        <div class="card card-secondary card-outlines">
                                                            <div class="card-header rtl">
                                                                <h3 class="card-title rtl block  block">خدمت {{obj.action|depo_location}} </h3>
                                                                <br>
                                                                    <h6 class="h6"></h6>
                                                                <h6 class="h6">  </h6>
                                                                <h6 class="h6">هزینه:
                                                                    {% if obj.price == None %}
                                                                    {% else %}
                                                                    {{obj.price}} 
                                                                    {% endif %}
                                                                </h6>
                                                            </div>
                                                            <div class="card-body rtl">
                                                                <table class="table">
                                                                    <tbody>
                                                                    <tr>
                                                                        <th>ثبت کننده</th>
                                                                        {% if obj.drive_register == None %}
                                                                        <td></td>
                                                                        {% else %}
                                                                        <td>{{obj.drive_register|register_user}}</td>
                                                                        {% endif %}
                            
                                                                        <th>سرویس دهنده</th>
                                                                        <td>{{obj.drive_id}}</td>
                            
                                                                        <th>ثبت وضعیت</th>
                                                                        <td>{{obj.drive_status_id}}</td>
                            
                                                                        <th>ثبت ارزیابی</th>
                                                                        <td>{{obj.assesmenter}}</td>
                                                                    </tr>  
                                                                    <tr>  
                                                                        <th>ارسال کننده</th>
                                                                        {% if obj.drive_register == None %}
                                                                        <td></td>
                                                                        {% else %}
                                                                        <td>{{obj.drive_register|register_user}}</td>
                                                                        {% endif %}
                            
                                                                        <th></th>
                                                                        <td></td>
                            
                                                                        <th>وضعیت سرویس</th>
                                                                        {% if obj.drive_status == None %}
                                                                        <td></td>
                                                                        {% else %}
                                                                        <td>{{obj.drive_status|inquiry_translate}}</td>
                                                                        {% endif %}
                            
                                                                        <th>ارزیابی</th>
                                                                        <td>{{obj.assesment_opinion}}</td>
                            
                                                                        <th>رسید</th>
                                                                        <td>{{obj.docer}}</td>
                                                                    </tr>  
                                                                    <tr>  
                                                                        <th>تاریخ سرویس</th>
                                                                        <td></td>
                            
                                                                        <th>تاریخ اختصاص</th>
                                                                        <td></td>
                            
                                                                        <th>تاریخ وضعیت</th>
                                                                        <td></td>
                            
                                                                        <th>تاریخ ارزیابی</th>
                                                                        <td>{{obj.assesment_dt|to_jalali}}</td>
                            
                                                                        <th>تاریخ رسید</th>
                                                                        <td>{{obj.doc_dt|to_jalali}}</td>
                                                                    </tr>  
                                                                    <tr>  
                                                                        <th>توضیحات ارسال</th>
                                                                        <td>
                                                                            {% if obj.drive_status_desc == None %}
                                                                            {% else %}
                                                                            {{obj.drive_status_desc}}
                                                                            {% endif %}

                                                                        </td>
                            
                                                                        <th>توضیحات اختصاص</th>
                                                                        <td></td>
                            
                                                                        <th>توضیحات وضعیت</th>
                                                                        <td></td>
                            
                                                                        <th>توضیحات ارزیابی</th>
                                                                        <td></td>
                            
                                                                        <th>توضیحات رسید</th>
                                                                        <td></td>
                                                                    </tr>
                            
                                                                    </tbody>
                                                                </table>
                                                            </div>
                                                        </div><!-- /card -->
                                                        {% endfor %}
                                                    </div>
                            
                                                </div>
                            
                                                <div class="row">
                                                    <div class="col-lg-12">
                                                        {% if request.user.user_id|final_register_access %}
                                                            {% if factor_main.reg_status == None %}
                                                            <div class="card  card-outline">
                                                                <div class="card-body">
                                                                    <form method="POST"  action="{% url 'customer:FactorFinalRegister' factor_id=factor_main.factor_id %}" id="saveForm" name="saveForm">
                                                                    {% csrf_token %}
                                                                        <input type="hidden" name="formtype" value="final_register">
                                                                        <input type="hidden" name="reg_status" value="CONFIRM">
                                                                        <div class="form-group form-group-sm row" style="width: 100%;">
                                                                            <div class="col-sm-10">
                                                                                <input type="text" name="factore_desc" class="form-control rtl" id="factore_desc" placeholder="توضیحات" >
                                                                            </div>
                                                                            <label for="factore_desc" class="col-sm-2 col-form-label">توضیحات</label>
                                                                        </div>

                                                                        <button class="btn btn-primary" type="submit" form="saveForm">ثبت نهایی فاکتور</button>
                                                                        <a href="{% url 'customer:FactorRejectStatus' factor_id=factor_main.factor_id %}" class="btn btn-danger" >حذف فاکتور</a>
                                                                        <a href="" class="btn btn-secondary float-right" >برگشت</a>
                                                                    </form>
                                                                </div>
                                                            </div>
                                                            {% else %}
                                                            {% endif %}
                                                        {% else %}
                                                        {% endif %}
                                                            {% if request.user.user_id|financial_approval_access %}
                                                                {% if factor_main.acc_confirmer == None %}
                                                                <div class="card card- card-outline">
                                                                    <div class="card-header rtl">
                                                                        <h3 class="card-title rtl block  bold">اعلام وضعیت مالی</h3>
                                                                    </div>
                                                                    
                                                                    <div class="card-body">
                                                                        <form method="POST" action="">
                                                                            <div class="form-group form-group-sm row" style="width: 100%;">
                                                                                <div class="col-sm-8">
                                                                                    <input type="text" name="acc_description" class="form-control rtl" id="acc_description" placeholder="توضیحات" >
                                                                                </div>
                                                                                <label for="acc_description" class="col-sm-3 col-form-label">توضیحات</label>
                                                                            </div>
                                                                            <div class="form-group form-group-sm row" style="width: 100%;">
                                                                                <div class="col-sm-8">
                                                                                    <select class="form-control select2bs4s rtl text-right float-right" style="width: 100%;" name="acc_status" id="acc_status">
                                                                                        <option value="CONFIRM">تایید</option>
                                                                                        <option value="REJECT">رد</option>
                                                                                    </select>
                                                                                </div>
                                                                                <label for="acc_status" class="col-sm-3 col-form-label">وضعیت</label>
                                                                            </div>
                                                                                <button class="btn btn-" type="submit">تایید مالی</button>
                                                                                <button class="btn btn-secondary" disabled>تایید مالی</button>
                                                                        </form>
                                                                    </div>
                                                                </div>
                                                                    {% else %}
                                                                {% endif %}
                                                            {% else %}
                                                            {% endif %}
                                                             
                                                            
                                                            {% if request.user.user_id|sales_register_access %}
                                                            <div class="card card- card-outline">
                                                                <div class="card-header rtl">
                                                                    <h3 class="card-title rtl block float-right"></h3>
                                                                </div>
                                                                <div class="card-body">
                                                                    <form method="POST"  action="">
                                                                        <div class="form-group form-group-sm row" style="width: 100%;">
                                                                            <div class="col-sm-8">
                                                                                <input type="text" name="description" class="form-control rtl" id="description" placeholder="توضیحات" >
                                                                            </div>
                                                                            <label for="description" class="col-sm-3 col-form-label">توضیحات</label>
                                                                        </div>
                                                                        <button class="btn btn-primary" type="submit">ثبت فاکتور فروش</button>
                                                                    </form>
                                                                </div>
                                                            </div> 
                                                            {% else %}
                                                            {% endif %}
                                                                  
                                                    </div>
                                                </div>
                                            </div><!-- /col-8 -->
                                            
                                            <div class="col-lg-3">
                                                {% if vendor_credit == None %}
                                                {% else %}
                                                <div class="card card- card-outlines">
                                                    <div class="card-header rtl">
                                                        <h3 class="card-title rtl block">فروشنده</h3>
                                                    </div>
                                                    <div class="card-body">
                                                        <table class="table ">
                                                            <tr>
                                                                <th>فروشگاه:</th>
                                                                <td>{{vendor_credit.vendor_name}}</td>
                                                            </tr>
                                                            <tr>
                                                                <th>اعتبار:</th>
                                                                <td>{{vendor_credit.credit}}</td>
                                                            </tr>
                                                            <tr>
                                                                <th>مانده اعتبار:</th>
                                                                <td class="alert alert-{{vendor_credit.credit_status}}">
                                                                    {{vendor_credit.reminded|inter}}</label>
                                                                </td>
                                                            </tr>
                                                        </table>                            
                                                    </div>
                                                </div>
                                                {% endif %}
                            
                                                <div class="card card-secondary card-tabs">
                                                            <div class="card-header p-0 pt-1">
                                                                <ul class="nav nav-tabs" id="custom-tabs-one-tab" role="tablist">
                                                                    <li class="nav-item">
                                                                        <a class="nav-link active" id="custom-tabs-one-home-tab" data-toggle="pill" href="#custom-tabs-one-home" role="tab" aria-controls="custom-tabs-one-home" aria-selected="true">مشتری</a>
                                                                    </li>
                                                                    <li class="nav-item">
                                                                        <a class="nav-link" id="custom-tabs-one-profile-tab" data-toggle="pill" href="#custom-tabs-one-profile" role="tab" aria-controls="custom-tabs-one-profile" aria-selected="false">آدرس جدید</a>
                                                                    </li>
                                                                </ul>
                                                            </div>
                                                            <div class="card-body">
                                                                <div class="tab-content" id="custom-tabs-one-tabContent">
                                                                    <div class="tab-pane fade active show" id="custom-tabs-one-home" role="tabpanel" aria-labelledby="custom-tabs-one-home-tab">
                                                                        <table class="table">
                                                                                {% if factor_address == None %}
                                                                                {% else %}
                                                                                <tr>
                                                                                    <th>کد مشتری:</th>
                                                                                    <td>{{factor_address.factor.buyer_id}}</td>
                                                                                </tr>
                                                                                {% endif %}
                                                                                <tr>
                                                                                    <th>شماره فاکتور اصلی:</th>
                                                                                    <td>{{ factor_main.factor_id}}</td>
                                                                                </tr>
                                                                                {% if customer_data.seller_buyer_id == None %}
                                                                                {% else %}
                                                                                <tr>
                                                                                    <th>کد مشتری فروشنده:</th>
                                                                                    <td>{{customer_data.seller_buyer_id|insert_slashes}}</td>
                                                                                </tr>
                                                                                {% endif %}
                                                                                {% if factor_main.seller_factor_id == None %}
                                                                                {% else %}
                                                                                <tr>
                                                                                    <th>شماره فاکتور فروشنده:</th>
                                                                                    <td>{{factor_main.seller_factor_id|insert_slashes}}</td>
                                                                                </tr>
                                                                                {% endif %}
                                                                                <tr>
                                                                                    <th>خریدار:</th>
                                                                                    <td>{{customer_data.name}}</td>
                                                                                </tr>
                                                                                {% if factor_address == None %}
                                                                                <tr>
                                                                                    <th>آدرس :</th>
                                                                                    <td> {{customer_data.address}}</td>
                                                                                </tr>
                                                                                {% else %}
                                                                                <tr>
                                                                                    <th>آدرس :</th>
                                                                                    <td> {{factor_address.address}}</td>
                                                                                </tr>
                                                                                {% endif %}
                                                                        </table>
                                                                    </div>
                                                                    <div class="tab-pane fade" id="custom-tabs-one-profile" role="tabpanel" aria-labelledby="custom-tabs-one-profile-tab">
                                                                        <table class="table ">
                                                                                <form method="POST"  action="{% url 'customer:add_address_factor' factor_id=factor_main.factor_id %}" id="n-address">
                                                                                    {% csrf_token %}
                                                                                    <tr>
                                                                                        <td>شهر</td>
                                                                                        <td colspan="20">
                                                                                            <select class="form-control select2bs4 rtl" style="width: 100%;" name="city_id" data-placeholder="" data-allow-clear="true" id="new-city">
                                                                                            
                                                                                                {% for city in cities %}
                                                                                                    <option value="{{ city.obj_item_id }}"> {{ city.obj_item_id|id_to_city}}</option>
                                                                                                {% endfor %}
                                                                                            </select>
                                                                                        </td>
                                                                                    </tr>
                                                                                    <tr>
                                                                                        <td>تلفن</td>
                                                                                        <td colspan="20">
                                                                                            <input type="text" name="phone" class="form-control rtl" id="new-phone" placeholder="تلفن">
                                                                                        </td>
                                                                                    </tr>
                                                                                    <tr>
                                                                                        <td>موبایل</td>
                                                                                        <td colspan="20">
                                                                                            <input type="text" name="mobile" class="form-control rtl" id="new-mobile" placeholder="موبایل">
                                                                                        </td>
                                                                                    </tr>
                                                                                    <tr>
                                                                                        <td>تحویل گیرنده</td>
                                                                                        <td colspan="20">
                                                                                            <input type="text" name="receiver" class="form-control rtl" id="new-receiver" placeholder="گیرنده">
                                                                                        </td>
                                                                                    </tr>
                                                                                    <tr>
                                                                                        <td>آدرس</td>
                                                                                        <td colspan="20">
                                                                                            <textarea type="text" name="address" class="form-control rtl" id="new-address" placeholder="آدرس"></textarea>
                                                                                        </td>
                                                                                    </tr>
                                                                                    <tr>
                                                                                        <td colspan="20">
                                                                                            <button class=" btn-block btn-primary" type="submit" >ثبت آدرس</button>
                                                                                        </td>
                                                                                    </tr>
                                                                                </form>
                                                                                    <tr>
                                                                                        <td>شهر</td>
                                                                                        <td colspan="20">
                                                                                             - تلفن:  - 
                                                                                        </td>
                                                                                </tr>
                                                                        </table>
                            
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            
                                                </div><!-- /.tab card -->
                                        
                                               
                                                <div class="card card-secondary">
                                                    <div class="card-header rtl">
                                                        <h3 class="card-title rtl block">استعلام حساب</h3>
                                                    </div>
                                                    <div class="card-body">
                                                        <table class="table ">
                                                            <tbody>
                                                            {% if inquiry_test.confirm_status == 'COND_CONFIRM' %}
                                                            <tr class="alert alert-warning rtl" >
                                                                <td><label role="alert">{{inquiry_test.inquiry_id}}   - {{inquiry_test.bank_branch}}   - {{inquiry_test.confirm_status|inquiry_translate}}</label></td>
                                                            </tr>
                                                            

                                                            {% elif inquiry_test.confirm_status == 'CONFIRM' %}    
                                                            <tr class="alert alert-success rtl">
                                                                <td><label  role="alert">{{inquiry_test.inquiry_id}} -   {{inquiry_test.bank_branch}} -   {{inquiry_test.confirm_status|inquiry_translate}}</label></td>
                                                            </tr>
                                                           

                                                            {% elif inquiry_test.confirm_status == 'REJECT' %}    
                                                            <tr class="alert alert-danger rtl">
                                                                <td><label  role="alert">{{inquiry_test.inquiry_id}}  -  {{inquiry_test.bank_branch}}  -  {{inquiry_test.confirm_status|inquiry_translate}} </label></td>
                                                            </tr>    
                                                     

                                                            {% elif inquiry_test.confirm_status == 'BACK' %}    
                                                            <tr class="rtl alert alert-info">
                                                                <td><label >{{inquiry_test.inquiry_id}}  -  {{inquiry_test.bank_branch}}   - {{inquiry_test.confirm_status|inquiry_translate}}</label></td>

                                                            </tr>    
                                                            
                             
                                                            {% endif %}    
                                                            
                                                            </tbody>
                                                           
                                                        </table>
                                                    </div>
                                                </div> <!-- /card -->
                                              
                                                
                                            </div> <!-- /col-4 -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- end:: Content -->
                    </div>

                    <!-- begin:: Footer -->
                    {% include "partials/footer.html" %}

                    <!-- end:: Footer -->
                </div>

                <!-- end:: Wrapper -->
            </div>

            <!-- end:: Page -->
        </div>
        <div class="modal fade" id="modal-product-item">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title">کالای جدید</h4>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <form method="POST" action="{% url 'customer:add_goods_factor' factor_id=factor_main.factor_id %}">
                    {% csrf_token %}
                    <div class="modal-body">

                            <input type="hidden" name="register" value="{{request.user.user_id}}">
                            <div class="form-group form-group-sm row">
                                <div class="col-sm-9">
                                    <select class="form-control select2bs4 rtl text-right float-right" style="width: 100%;" name="obj_item">
                                        <option value="115009" selected>CM6000BL-T</option>
                                        <option value="115036">CMT6000BL-T</option>
                                        <option value="115040">CM8000BL-T</option>
                                        <option value="115066">CMT8000BL-T</option>
                                        <option value="1150025">CP9000BL-T</option>
                                        <option value="115024">CM12000BL-T</option>
                                        <option value="1151001">پنل مدل expono ساده</option>
                                        <option value="1151019">پنل مدل امانوئل</option>
                                        <option value="1050487">موتور BLDC</option>

                                    </select>
                                </div>
                                <label for="product_id" class="col-sm-3 col-form-label">محصول</label>
                            </div>
                            <div class="form-group form-group-sm row">
                                <div class="col-sm-9">
                                    <select class="form-control select2bs4 rtl text-right float-right" style="width: 100%;" name="amount">
                                        <option value="1" selected>1</option>
                                        <option value="2">2</option>
                                        <option value="3">3</option>
                                        <option value="4">4</option>
                                        <option value="5">5</option>
                                        <option value="6">6</option>
                                        <option value="7">7</option>
                                        <option value="8">8</option>
                                        <option value="9">9</option>
                                        <option value="10">10</option>
                                    </select>
                                </div>
                                <label for="amount" class="col-sm-3 col-form-label">تعداد</label>
                            </div>
        
                    </div>
                    <div class="modal-footer justify-content-between">
                        <button type="button" class="btn btn-default" data-dismiss="modal">بستن</button>
                        <button type="submit" class="btn btn-primary">ثبت</button>
                    </div>
                    </form>
                </div>
                <!-- /.modal-content -->
            </div>
            <!-- /.modal-dialog -->
        </div>
        
        
        <div class="modal fade" id="modal-inquiry1">
            <div class="modal-dialog">
                <div class="modal-content">
                <div class="modal-header rtl">
                    <h4 class="modal-title">دریافت از مشتری</h4>
                </div>
                <form method="POST" action="{% url 'customer:FactorWithFactorID' factor_id=factor_main.factor_id %}" enctype="multipart/form-data" id="frm-payment" autocomplete="off">
                    {% csrf_token %}
                    <div class="modal-body">
                        <input type="hidden" name="form_type" value="paywayform">
                        <input id="reference" type="hidden" name="factor_id" value="{{factor_main.factor_id}}">
                        <input type="hidden" value="{{request.user.user_id}}" name="register" class="customer_id">
                        <div class="form-group form-group-sm row">
                            <div class="col-sm-8">
                                <select class="form-control select2bs4s rtl text-left" style="width: 100%;" name="pay_type" id="type" onchange="showHideFields()">
                                    <option value="CASH" selected>وجه نقد</option>
                                    <option value="CART">کارت خوان</option>
                                    <option value="CARTOCART">کارت به کارت</option>
                                    <option value="CHEQUE">چک</option>
                                </select>

                            </div>
                            <label for="pay_type" class="col-sm-3 col-form-label">نوع</label>
                        </div>

                        <div id="cashFields" style="display: none;">
                            <!-- Empty -->
                        </div>

                        <div id="chequeFields" style="display: none;">
                            <div class="form-group form-group-sm row" id="div_bank_id">
                                <div class="col-sm-8">
                                <select class="form-control select2bs4 rtl bank-list" style="width: 100%;" name="bank_id" data-placeholder="بانک" data-allow-clear="true">
                                        {% for bank in banks %}
                                        <option value="{{bank.obj_item_id}}">{{bank.name}}</option>
                                        {% endfor %}
                                </select>
                                </div>
                                <label for="bank_id" class="col-sm-4 col-form-label">بانک</label>
                            </div>
                            <div class="form-group form-group-sm row" id="div_no">
                                <div class="col-sm-8">
                                    <input type="text" name="no" id="no" class="form-control rtl text-left" placeholder="کد شعبه" >
                                </div>
                                <label for="no" id="lbl_no" class="col-sm-4 col-form-label">شماره </label>
                            </div>
                            <div class="form-group form-group-sm row" id="div_bank_branch">
                                <div class="col-sm-8">
                                <input type="text" name="branch_code" id="branch_code" class="form-control rtl text-left" placeholder="نام شعبه" >
                                </div>
                                <label for="branch_code" class="col-sm-4 col-form-label">کد شعبه</label>
                            </div>
                     
                            <div class="form-group form-group-sm row" id="div_account_owner">
                                <div class="col-sm-8">
                                <input type="text" name="owner" class="form-control rtl text-left" id="owner" placeholder="نام صاحب حساب" >
                                </div>
                                <label for="owner" class="col-sm-4 col-form-label">نام صاحب حساب</label>
                            </div>
                        </div>

                        <div id="cartFields" style="display: none;">
                            <div class="form-group form-group-sm row" id="div_bank_id">
                                <div class="col-sm-8">
                                <select class="form-control select2bs4 rtl bank-list" style="width: 100%;" name="bank_id" data-placeholder="بانک" data-allow-clear="true">
                                
                                    {% for bank in banks %}
                                    <option value="{{bank.obj_item_id}}">{{bank.name}}</option>
                                    {% endfor %}
                                    
                                </select>
                                </div>
                                <label for="bank_id" class="col-sm-4 col-form-label">بانک</label>
                            </div>
                            <div class="form-group form-group-sm row" id="div_no">
                                <div class="col-sm-8">
                                    <input type="text" name="no" id="no" class="form-control rtl text-left" placeholder="کد شعبه" >
                                </div>
                                <label for="no" id="lbl_no" class="col-sm-4 col-form-label">شماره</label>
                            </div>
                            <div class="form-group form-group-sm row" id="div_bank_branch">
                                <div class="col-sm-8">
                                <input type="text" name="branch_code" id="branch_code" class="form-control rtl text-left" placeholder="نام شعبه" >
                                </div>
                                <label for="branch_code" class="col-sm-4 col-form-label">کد شعبه</label>
                            </div>
                        </div>

                        <div id="cartocartFields" style="display: none;">

                            <div class="form-group form-group-sm row" id="div_bank_id">

                                <div class="col-sm-8">

                                <select class="form-control select2bs4 rtl bank-list" style="width: 100%;" name="bank_id" data-placeholder="بانک" data-allow-clear="true">
                                    {% for bank in banks %}
                                    <option value="{{bank.obj_item_id}}">{{bank.name}}</option>
                                    {% endfor %}
                                </select>
                                </div>
                                <label for="bank_id" class="col-sm-4 col-form-label">بانک</label>

                            </div>

                            <div class="form-group form-group-sm row" id="div_no">
                                <div class="col-sm-8">
                                    <input type="text" name="no" id="no" class="form-control rtl text-left" placeholder="کد شعبه" >
                                </div>
                                <label for="no" id="lbl_no" class="col-sm-4 col-form-label">شماره</label>
                            </div>
                            <div class="form-group form-group-sm row" id="div_bank_branch">
                                <div class="col-sm-8">
                                <input type="text" name="branch_code" id="branch_code" class="form-control rtl text-left" placeholder="نام شعبه" >
                                </div>
                                <label for="branch_code" class="col-sm-4 col-form-label">کد شعبه</label>
                            </div>
                        </div>

                        <div id="commonFields" >
                            <div class="form-group form-group-sm row">
                                <div class="col-sm-8">
                                    <input type="text" name="price" id="depoit-price" class="form-control numeric" placeholder="مبلغ" >
                                </div>
                                <label for="vprice2" id="depoit-price" class="col-sm-4 col-form-label">مبلغ</label>
                            </div>
                            <div class="form-group form-group-sm row">
                                <div class="col-sm-8">
                                    <input type="text" name="description" class="form-control rtl" id="description" placeholder="توضیحات" >
                                </div>
                                <label for="description" class="col-sm-4 col-form-label">توضیحات</label>
                            </div>
                            <div class="form-group form-group-sm row" id="div_image">
                                <div class="col-sm-8">
                                    <div class="custom-file">
                                        <input type="file" name="image" id="image" class="rtl custom-file-input" placeholder="تصویر" >
                                        <label class="custom-file-label" for="image">تصویر</label>
                                    </div>
                                </div>
                                <label for="cheque_image" class="col-sm-4 col-form-label">تصویر</label>
                            </div>
                        </div>
                        
                        
                    </div>
                    <div class="modal-footer justify-content-between">
                        <button type="submit" class="btn btn-primary">ثبت</button>
                        <button type="button" class="btn btn-default" data-dismiss="modal">بستن</button>
                    </div>
                </form>
            </div>
            </div>
            <!-- /.modal-dialog -->
        </div>
      
        
        <div class="modal fade" id="modal-document">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title">مدارک</h4>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <form method="POST" action="{% url 'customer:add_document_factor' factor_id=factor_main.factor_id %}" enctype="multipart/form-data">
                        {% csrf_token %}
                    <div class="modal-body">
                                <div class="form-group form-group-sm row" style="width: 100%;">
                                    <input type="hidden" name="level_type" value="FACTOR">
                                    <input type="hidden" name="register" value="{{ request.user.user_id }}">
                                    <div class="col-sm-8">
                                        <select class="form-control select2bs4s rtl text-right float-right" style="width: 100%;" name="document_type">
                                            <option value="CHEQUE">چک</option>
                                            <option value="CART">کارت خوان</option>
                                            <option value="FORM">فرم درخواست</option>
                                            <option value="OTHER">سایر موارد</option>
                                            
                                        </select>
                                    </div>
                                    <label for="document_type" class="col-sm-4 col-form-label">نوع مدرک</label>
                                </div>
                                <div class="form-group form-group-sm row">
                                    <div class="col-sm-8">
                                        <div class="custom-file">
                                            <input type="file" name="uri" id="uri">
                                        </div>
                                    </div>
                                    <label for="uri" class="col-sm-4 col-form-label">تصویر مدرک</label>
                                </div>
                                <div class="form-group form-group-sm row">
                                    <div class="col-sm-8">
                                        <input type="text" name="description" class="form-control rtl" id="description" placeholder="توضیحات" value="">
                                    </div>
                                    <label for="description" class="col-sm-4 col-form-label">توضیحات</label>
                                </div>
                    </div>
                    <div class="modal-footer justify-content-between">
                        <button type="button" class="btn btn-default" data-dismiss="modal">بستن</button>
                        <button type="submit" class="btn btn-primary">ارسال مدرک</button>
                    </div>
                    </form>
                </div>
                <!-- /.modal-content -->
            </div>
            <!-- /.modal-dialog -->
        </div>




        <div class="modal fade" id="modal-assign-depo">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title">اختصاص انبار</h4>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <form method="POST" action="{% url 'customer:add_depo_factor'  %}">
                        {% csrf_token %}

                        <input name="factor_item_id" id="sale_factor_item_id" type="hidden" value="">
                        <input name="city_id" id="sale_city_id" type="hidden" value="">
                        <input name="phone" id="sale_phone" type="hidden" value="">
                        <input name="mobile" id="sale_mobile" type="hidden" value="">
                        <input name="address" id="sale_address" type="hidden" value="">
                        <input name="receiver" id="sale_receiver" type="hidden" value="">
                        <div class="modal-body">
                                <div class="form-group form-group-sm row">
                                    <div class="col-sm-9">
                                        <select class="form-control select2bs4s rtl text-right float-right" id="sale_amount" name="amount">
                                            <option value=""></option>
                                        </select>
                                    </div>
                                    <label for="product_id" class="col-sm-3 col-form-label">تعداد</label>
                                </div>
        
                                <div class="form-group form-group-sm row">
                                    <div class="col-sm-9">
                                        <select class="form-control select2bs4s rtl text-right float-right" id="factor_address">
                                            <option value="" selected></option>
                                                {% for address in depo_addresses %}
                                                <option value="{{address.factor_id}}" 
                                                    data-city-id="{{ address.city_id }}"
                                                    data-address="{{ address.address }}"
                                                    data-phone="{{ address.phone }}"
                                                    data-mobile="{{ address.mobile }}"
                                                    data-receiver="{{ address.receiver }}">
                                                    آدرس :{{ address.address }}/{{ address.receiver }}/{{ address.city_id|id_to_city }}/{{ address.address }}/ 
                                                </option>
                                                {% endfor %}
                                        </select>
                                    </div>
                                    <script>
                                        document.getElementById('factor_address').addEventListener('change', function () {
                                            var selectedOption = this.options[this.selectedIndex];
                                            document.getElementById('sale_city_id').value = selectedOption.getAttribute('data-city-id');
                                            document.getElementById('sale_address').value = selectedOption.getAttribute('data-address');
                                            document.getElementById('sale_phone').value = selectedOption.getAttribute('data-phone');
                                            document.getElementById('sale_mobile').value = selectedOption.getAttribute('data-mobile');
                                            document.getElementById('sale_receiver').value = selectedOption.getAttribute('data-receiver');
                                        });
                                    </script>
                                    <label for="factor_address" class="col-sm-3 col-form-label">آدرس</label>
                                    
                                </div>
        
                                <div class="form-group form-group-sm row">

                                    <div class="col-sm-9">
                                        <select class="form-control select2bs4s rtl text-right float-right" style="width: 100%;" name="depo" id="sale_depo">
                                            
                                            <option value="" selected></option>
                                            
                                        </select>
                                    </div>

                                    <label for="product_id" class="col-sm-3 col-form-label">انبار</label>
                                </div>
                        </div>
                        <div class="modal-footer justify-content-between">
                            <button type="submit" class="btn btn-primary">ارسال به انبار</button>
                            <button type="button" class="btn btn-default" data-dismiss="modal">بستن</button>
                        </div>
                </form>
            </div>
        </div>
    </div>
                       
        <!-- begin::Global Config(global config for global JS sciprts) -->
        {% include "partials/script.html" %}
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                // Listen to the 'show.bs.modal' event on the modal
                $('#modal-inquiry1').on('show.bs.modal', function(event) {
                    // Get the button (<a> tag) that triggered the modal
                    var button = $(event.relatedTarget);

                    // Get the 'data-buyer' attribute from the button
                    var buyerValue = button.data('customer');

                    // Find the hidden input element by its ID and update its value
                    $('#hiddenInput2').val(buyerValue);
            });
            });
                    
        </script>
        <!-- <script type="text/javascript">
            $(document).ready(function() {
        var depoData = JSON.parse('{{ depo_data_json|safe }}');

        $('#factor_address').change(function() {
            $('#sale_city_id').val($(this).find(':selected').data('city-id'));
            $('#sale_phone').val($(this).find(':selected').data('phone'));
            $('#sale_mobile').val($(this).find(':selected').data('mobile'));
            $('#sale_address').val($(this).find(':selected').data('address'));
            $('#sale_receiver').val($(this).find(':selected').data('receiver'));

            var cityId = $(this).find(':selected').data('city-id').toString();

            var depoInfo = depoData[cityId] || [];

            $('#sale_depo').empty();  // Clear any existing options

            if (depoInfo.length === 0) {
                // Handle the case when the array is empty
                $('#sale_depo').append('<option value="">هیچ انباری موجود نیست</option>');
            } else {
                depoInfo.forEach(function(item) {
                    // Updated the text to include net_amount beside the title
                    var optionText = item.title + ' (موجودی: ' + item.net_amount + ')';
                    var option = $('<option></option>').val(item.obj_item_id).text(optionText);
                    $('#sale_depo').append(option);
                });
            }
        });

        $('#modal-assign-depo').on('shown.bs.modal', function() {
            $('#factor_address').trigger('change');
        });
    });

    $('#modal-assign-depo').on('shown.bs.modal', function () {
        $('#sale_depo').empty();
        $('#sale_depo').append('<option value="" selected></option>');  // Add an empty option
    });
        </script> -->
        <!-- <script>
            document.addEventListener('DOMContentLoaded', function() {
    // Function to update the second select based on the selected obj_item_id
    function updateSecondSelect(objItemId) {
        var depoData = JSON.parse('{{ depo_data_json|safe }}');
        var cityId = $('#factor_address').find(':selected').data('city-id').toString();
        var depoInfo = depoData[cityId] || [];

        $('#sale_city_id').val($('#factor_address').find(':selected').data('city-id'));
        $('#sale_phone').val($('#factor_address').find(':selected').data('phone'));
        $('#sale_mobile').val($('#factor_address').find(':selected').data('mobile'));
        $('#sale_address').val($('#factor_address').find(':selected').data('address'));
        $('#sale_receiver').val($('#factor_address').find(':selected').data('receiver'));

        $('#sale_depo').empty(); // Clear any existing options

        if (depoInfo.length === 0) {
            $('#sale_depo').append('<option value="">هیچ انباری موجود نیست</option>');
        } else {
            depoInfo.forEach(function(item) {
                // Check if the item's related_obj_item_id matches the selected obj_item_id
                if (item.related_obj_item_id === objItemId) {
                    var optionText = item.title + ' (موجودی: ' + item.net_amount + ')';
                    var option = $('<option></option>').val(item.obj_item_id).text(optionText);
                    $('#sale_depo').append(option);
                }
            });
        }
    }

    // Event delegation to handle button click
    document.addEventListener('click', function(event) {
        // Check if the clicked element is a button with the class 'btn-asign-depo'
        if (event.target.classList.contains('btn-asign-depo')) {
            // Retrieve obj_item_id from the clicked button using jQuery
            var objItemId = $(event.target).data('obid');
            console.log('Selected obj_item_id (from button click):', objItemId);

            // Update the second select
            updateSecondSelect(objItemId);
        }
    });

    // Trigger the change event for '#factor_address' when the modal is shown
    var modalAssignDepo = document.getElementById('modal-assign-depo');
    modalAssignDepo.addEventListener('shown.bs.modal', function() {
        var factorAddress = document.getElementById('factor_address');
        var changeEvent = new Event('change', { bubbles: true });
        factorAddress.dispatchEvent(changeEvent);
    });
    
    // Initialize the second select when the modal is shown
    modalAssignDepo.addEventListener('shown.bs.modal', function () {
        var saleDepo = document.getElementById('sale_depo');
        saleDepo.innerHTML = '<option value="" selected></option>';  // Add an empty option
    });
});
        </script> -->
        
        <script>
            document.addEventListener('DOMContentLoaded', function () {
    // Function to update the second select based on the selected obj_item_id
    function updateSecondSelect(objItemId) {
        var depoData = JSON.parse('{{ depo_data_json|safe }}');
        var cityId = $('#factor_address').find(':selected').data('city-id').toString();
        var depoInfo = depoData[cityId] || [];

        $('#sale_city_id').val($('#factor_address').find(':selected').data('city-id'));
        $('#sale_phone').val($('#factor_address').find(':selected').data('phone'));
        $('#sale_mobile').val($('#factor_address').find(':selected').data('mobile'));
        $('#sale_address').val($('#factor_address').find(':selected').data('address'));
        $('#sale_receiver').val($('#factor_address').find(':selected').data('receiver'));

        $('#sale_depo').empty(); // Clear any existing options

        if (depoInfo.length === 0) {
            $('#sale_depo').append('<option value="">هیچ انباری موجود نیست</option>');
        } else {
            depoInfo.forEach(function (item) {
                // Check if the item's related_obj_item_id matches the selected obj_item_id
                if (item.related_obj_item_id === objItemId) {
                    var optionText = item.title + ' (موجودی: ' + item.net_amount + ')';
                    var option = $('<option></option>').val(item.obj_item_id).text(optionText);
                    $('#sale_depo').append(option);
                }
            });
        }
    }

    // Event delegation to handle button click
    document.addEventListener('click', function (event) {
        // Check if the clicked element is a button with the class 'btn-asign-depo'
        if (event.target.classList.contains('btn-asign-depo')) {
            // Retrieve obj_item_id and factor_item_id from the clicked button using jQuery
            var objItemId = $(event.target).data('obid');
            var factorItemId = $(event.target).data('fid');
            console.log('Selected obj_item_id (from button click):', objItemId);
            console.log('Selected factor_item_id (from button click):', factorItemId);

            // Update the 'factor_item_id' input element in the modal
            $('#sale_factor_item_id').val(factorItemId);

            // Update the second select
            updateSecondSelect(objItemId);
        }
    });

    // Trigger the change event for '#factor_address' when the modal is shown
    var modalAssignDepo = document.getElementById('modal-assign-depo');
    modalAssignDepo.addEventListener('shown.bs.modal', function () {
        var factorAddress = document.getElementById('factor_address');
        var changeEvent = new Event('change', { bubbles: true });
        factorAddress.dispatchEvent(changeEvent);
    });

    // Initialize the second select when the modal is shown
    modalAssignDepo.addEventListener('shown.bs.modal', function () {
        var saleDepo = document.getElementById('sale_depo');
        saleDepo.innerHTML = '<option value="" selected></option>';  // Add an empty option
    });
});

        </script>
        




        <script>
            function showHideFields() {
            var selectedOption = document.getElementById("type").value;
            var cashFields = document.getElementById("cashFields");
            var chequeFields = document.getElementById("chequeFields");
            var cartFields = document.getElementById("cartFields");
            var cartocartFields = document.getElementById("cartocartFields");
            var commonFields = document.getElementById("commonFields");
            
            // Hide all fields by default
            cashFields.style.display = "none";
            chequeFields.style.display = "none";
            cartFields.style.display = "none";
            cartocartFields.style.display = "none";
            commonFields.style.display = "none";
    
            // Show fields based on the selected option
            if (selectedOption === "CASH") {
                cashFields.style.display = "block";
                commonFields.style.display = "block"; // Show common fields for "CASH"
    
            } else if (selectedOption === "CHEQUE") {
                chequeFields.style.display = "block";
                commonFields.style.display = "block"; // Show common fields for "CHEQUE"
            }
            else if (selectedOption === "CARTOCART") {
                cartocartFields.style.display = "block";
                commonFields.style.display = "block"; // Show common fields for "CHEQUE"
            }
            else {
                cartFields.style.display = "block";
                commonFields.style.display = "block"; // Show common fields for "CHEQUE"
            }
        }
            </script>

        
        <script>
        // Function to calculate the sum of all row-total, price, and total-discount values
function calculateSums() {
    // Initialize sums to 0
    let rowTotalSum = 0;
    let priceSum = 0;
    let discountSum = 0;

    // Find all td elements with class "row-total" and sum their contents
    const rowTotalElements = document.querySelectorAll('.row-total');
    rowTotalElements.forEach(function(element) {
        const value = parseFloat(element.textContent);
        if (!isNaN(value)) {
            rowTotalSum += value;
        }
    });

    // Find all td elements with class "price" and sum their contents
    const priceElements = document.querySelectorAll('.price');
    priceElements.forEach(function(element) {
        const value = parseFloat(element.textContent);
        if (!isNaN(value)) {
            priceSum += value;
        }
    });

    // Find all td elements with class "total-discount" and sum their contents
    const discountElements = document.querySelectorAll('.total-discount');
    discountElements.forEach(function(element) {
        const value = parseFloat(element.textContent);
        if (!isNaN(value)) {
            discountSum += value;
        }
    });

    // Update the content of the td elements for the sums
    const grandRowTotalElement = document.querySelector('.grand-row-total');
    if (grandRowTotalElement) {
        grandRowTotalElement.innerHTML = rowTotalSum + " <small>ریال</small>";
    }

    const grandTotalPriceElement = document.querySelector('.grand-total-price');
    if (grandTotalPriceElement) {
        grandTotalPriceElement.innerHTML = priceSum + " <small>ریال</small>";
    }

    const grandTotalDiscountElement = document.querySelector('.grand-total-discount');
    if (grandTotalDiscountElement) {
        grandTotalDiscountElement.innerHTML = discountSum + " <small>ریال</small>";
    }
}

// Execute the function to calculate and display the sums
calculateSums();


 
        </script>


<script>
    $(document).ready(function() {
    $('#modal-assign-depo').on('show.bs.modal', function(event) {
        var button = $(event.relatedTarget);  // Button that triggered the modal
        var amount = parseInt(button.data('amount'));  // Extract info from data-* attributes
        var sended = parseInt(button.data('sended'));
        var difference = amount - sended;
        
        var amountSelect = $('#sale_amount');
        amountSelect.empty();  // Clear any existing options
        
        for (var i = 1; i <= difference; i++) {
            var option = $('<option></option>').val(i).text(i);
            amountSelect.append(option);
        }
    });
});
</script>
        <!--end::Page Scripts -->
    </body>

    <!-- end::Body -->

</html>